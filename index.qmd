---
title: "Смета расходов с 01.11.2024г."
format: html
editor: source
---

```{r}
#| echo: false
#| message: false

library(tidyverse)
library(plotly)

df <- readxl::read_xlsx("smeta_01.11.2024.xlsx")

df |> 
  group_by(level_1) |> 
  summarise(value = sum(amount)) |> 
  mutate(parents = "") |> 
  rename(labels = level_1) ->
  l1

df |> 
  group_by(level_2, level_1) |> 
  summarise(value = sum(amount)) |>
  rename(parents = level_1,
         labels = level_2) |> 
  na.omit() ->
  l2

df |> 
  group_by(level_3, level_2) |> 
  summarise(value = sum(amount)) |>
  rename(parents = level_2,
         labels = level_3) |> 
  na.omit() ->
  l3

df |> 
  group_by(level_4, level_3) |> 
  summarise(value = sum(amount)) |>
  rename(parents = level_3,
         labels = level_4) |> 
  na.omit() ->
  l4

l1 |> 
  bind_rows(l2, l3, l4) |> 
  select(parents, labels, value)  ->
  all_merged

plot_ly(
  type='treemap',
  labels=all_merged$labels,
  parents=all_merged$parents,
  values=all_merged$value)
```

